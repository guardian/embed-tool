<!DOCTYPE html>
<html>
<head>
    <base href="." target="_blank">
    <title>NBA Embed</title>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

    <script src="https://interactive.guim.co.uk/libs/iframe-messenger/iframeMessenger.js"></script>
    <script>
        iframeMessenger.enableAutoResize();
    </script>
    <script type='text/javascript' src="../handlebars.min.js"></script>

    <script type='application/json'>
        {
            "type": "Sport",
            "size": "supporting",
            "tip": "NBA embeds should be used to highlight players mentioned within the piece when they've had a notable game or season",
            "fields": [
                {
                    "name": "Opinion Tint",
                    "type": "checkbox"
                },

                {
                    "name": "Headline",
                    "type": "text",
                    "default": "vs Brooklyn Nets",
                    "tip": "Optional"
                },

                {
                    "name": "Name",
                    "type": "text",
                    "default": "Giannis Antetokounmpo"
                },

                {
                    "name": "Team",
                    "type": "select",
                    "options": ["No Team", "Atlanta Hawks", "Boston Celtics", "Brooklyn Nets", "Charlotte Hornets", "Chicago Bulls", "Cleveland Cavaliers", "Dallas Mavericks", "Denver Nuggets", "Detroit Pistons", "Golden State Warriors", "Houston Rockets", "Indiana Pacers", "LA Clippers", "LA Lakers", "Memphis Grizzlies", "Miami Heat", "Milwaukee Bucks", "Minnesota Timberwolves", "New Orleans Pelicans", "New York Knicks", "Oklahoma City Thunder", "Orlando Magic", "Philadelphia 76ers", "Phoenix Suns", "Portland Trail Blazers", "Sacramento Kings", "San Antonio Spurs", "Toronto Raptors", "Utah Jazz", "Washington Wizards"]
                },

                {
                    "name": "Number",
                    "type": "number",
                    "default": 77
                },

                {
                    "name": "Position",
                    "type": "select",
                    "options": ["Point guard", "Shooting guard", "Small forward", "Power forward", "Center"]
                },

                {
                    "name": "Label 1",
                    "type": "text",
                    "default": "Points per game"
                },

                {
                    "name": "Number 1",
                    "type": "number",
                    "default": 0
                },

                {
                    "name": "Label 2",
                    "type": "text",
                    "default": "Assists per game"
                },

                {
                    "name": "Number 2",
                    "type": "number",
                    "default": 0
                },

                {
                    "name": "Label 3",
                    "type": "text",
                    "default": "Rebounds per game"
                },

                {
                    "name": "Number 3",
                    "type": "number",
                    "default": 0
                },

                {
                    "name": "Label 4",
                    "type": "text",
                    "default": "Field goal percentage"
                },

                {
                    "name": "Number 4",
                    "type": "number",
                    "default": 0
                }
            ]
        }
    </script>

    <script type='application/sass'>
        @import './node_modules/sass-mq/mq';
        @import './src/common/style/vars';
        @import './src/common/style/fonts';
        @import './src/common/style/base';

        .wrapper {
            position: relative;
            border-top: 1px solid $c-light-grey;
            border-bottom: 1px solid $c-light-grey;
            background-color: $c-white;
            max-width: 620px;
        }

        .wrapper--tint {
            background-color: $c-tint;
        }

        .header {
            position: relative;
            padding: 4px 0 36px 0;
            box-sizing: border-box;
            overflow: hidden;
        }

        .header__name {
            margin: 0 0 2px;
            font-weight: normal;
            font-family: 'Guardian Egyptian Web';
            font-weight: 700;
            font-size: 24px;
            line-height: 1.1;
            color: $c-black;
        }

        .header__name--type {
            color: $c-blue;
        }

        .header__meta {
            position: absolute;
            bottom: 6px;
            margin: 0;
            font-size: 16px;
            line-height: 1;
            font-weight: normal;
            font-family: 'Guardian Sans Web';
            color: $c-black;

            span:first-of-type {
                position: relative;
                margin-right: 12px;

                &:after {
                    content: '';
                    position: absolute;
                    width: 4px;
                    height: 4px;
                    top: 0;
                    bottom: 0;
                    right: -10px;
                    margin: auto;
                    background-color: $c-blue;
                    border-radius: 4px;
                }
            }
        }

        .header__number {
            position: absolute;
            font-family: 'Guardian Figures';
            font-weight: normal;
            top: 0px;
            line-height: 1;
            right: 0px;
            opacity: 0.2;
            font-size: 60px;

            &:before {
                content: '#';
                font-family: 'Guardian Egyptian Web';
                font-weight: 300;
            }
        }

        .stat {
            position: relative;
            width: 100%;
            border-top: 1px solid $c-light-grey;
            padding: 5px 0 18px 0;
            box-sizing: border-box;
            font-family: 'Guardian Sans Web';
            color: $c-black;

            &--last,
            &:last-of-type {
                border-right: 0;
            }
        }

        .stat__number {
            font-family: 'Guardian Figures';
            color: $c-blue;
            font-weight: normal;
            font-size: 24px;
            line-height: 1.2;
            text-align: right;
            position: absolute;
            right: 0;
            top: 2px;
        }

        @mixin colourScheme($team, $primaryColour, $secondaryColour) {
            .wrapper--#{$team} {
                .header__name,
                .header__meta,
                .header__number {
                    color: $primaryColour;
                }

                .header__name--type {
                    color: $secondaryColour;
                }

                .stat__number {
                    color: $primaryColour;
                }

                .header__meta span:first-of-type:after {
                    background-color: $secondaryColour;
                }
            }
        }

        @include colourScheme('generic', $c-black, $c-blue);
        @include colourScheme('atlanta-hawks', $c-red, $c-off-yellow);
        @include colourScheme('boston-celtics', $c-light-green, $c-black);
        @include colourScheme('brooklyn-nets', $c-black, $c-dark-grey);
        @include colourScheme('charlotte-hornets', $c-light-blue, $c-blue);
        @include colourScheme('chicago-bulls', $c-red, $c-black);
        @include colourScheme('cleveland-cavaliers', $c-dark-red, $c-off-yellow);
        @include colourScheme('dallas-mavericks', $c-blue, $c-black);
        @include colourScheme('denver-nuggets', $c-dark-blue, $c-off-yellow);
        @include colourScheme('detroit-pistons', $c-red, $c-dark-blue);
        @include colourScheme('golden-state-warriors', $c-blue, $c-off-yellow);
        @include colourScheme('houston-rockets', $c-red, $c-dark-grey);
        @include colourScheme('indiana-pacers', $c-off-yellow, $c-dark-blue);
        @include colourScheme('la-clippers', $c-dark-blue, $c-red);
        @include colourScheme('la-lakers', $c-dark-purple, $c-off-yellow);
        @include colourScheme('memphis-grizzlies', $c-dark-blue, $c-dark-grey);
        @include colourScheme('miami-heat', $c-red, $c-black);
        @include colourScheme('milwaukee-bucks', $c-green, $c-brown);
        @include colourScheme('minnesota-timberwolves', $c-dark-blue, $c-blue);
        @include colourScheme('new-orleans-pelicans', $c-red, $c-dark-blue);
        @include colourScheme('new-york-knicks', $c-orange, $c-blue);
        @include colourScheme('oklahoma-city-thunder', $c-orange, $c-light-blue);
        @include colourScheme('orlando-magic', $c-dark-blue, $c-dark-grey);
        @include colourScheme('philadelphia-76ers', $c-dark-blue, $c-light-red);
        @include colourScheme('phoenix-suns', $c-light-orange, $c-dark-blue);
        @include colourScheme('portland-trail-blazers', $c-red, $c-black);
        @include colourScheme('sacramento-kings', $c-dark-purple, $c-dark-grey);
        @include colourScheme('san-antonio-spurs', $c-black, $c-dark-grey);
        @include colourScheme('toronto-raptors', $c-black, $c-red);
        @include colourScheme('portland-trail-blazers', $c-red, $c-black);
        @include colourScheme('utah-jazz', $c-dark-blue, $c-off-yellow);
        @include colourScheme('washington-wizards', $c-light-red, $c-dark-blue);

        .wrapper--no-team {
            .header__meta .input[data-input='team'] {
                display: none;
            }
        }
    </script>
</head>

<body>
    <div class='target'>
        <!-- this is where the template will be injected -->
    </div>

    <script class="template" type="text/x-handlebars-template">
        <div class='wrapper wrapper--{{ handlise team }} {{#if opinion-tint}}wrapper--tint{{/if}}'>
            <div class='header'>
                <h1 class='header__name input' data-input='name'>{{ name }}</h1>
                {{#if headline}}
                    <h1 class='header__name header__name--type input' data-input='headline'>{{ headline }}</h1>
                {{/if }}

                <h2 class='header__meta'>
                    <span class='input' data-input='team'>{{ team }}</span>
                    <span class='input' data-input='position'>{{ position }}</span>
                </h2>

                <span class='header__number input' data-input='player-number'>{{ number }}</span>
            </div>

            <div class='stats'>
                {{#if label-1 }}
                    <div class='stat'>
                        <div class='stat__name'>{{ label-1 }}</div>
                        <div class='stat__number'>{{ number-1 }}</div>
                    </div>
                {{/if}}

                {{#if label-2 }}
                    <div class='stat'>
                        <div class='stat__name'>{{ label-2 }}</div>
                        <div class='stat__number'>{{ number-2 }}</div>
                    </div>
                {{/if}}

                {{#if label-3 }}
                    <div class='stat'>
                        <div class='stat__name'>{{ label-3 }}</div>
                        <div class='stat__number'>{{ number-3 }}</div>
                    </div>
                {{/if}}

                {{#if label-4 }}
                    <div class='stat'>
                        <div class='stat__name'>{{ label-4 }}</div>
                        <div class='stat__number'>{{ number-4 }}</div>
                    </div>
                {{/if}}
            </div>
        </div>
    </script>

    <script type='text/javascript'>
        var params;

        function getPageParameters(query) {
            query = query.split('?')[1];

            var vars = query.split("&");
            var query_string = {};
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split("=");
                    pair[1] = decodeURIComponent(pair[1]);

                if (pair[1] === 'true' || pair[1] === 'false') {
                    pair[1] = JSON.parse(pair[1]);
                }

                if (typeof query_string[pair[0]] === "undefined") {
                    query_string[pair[0]] = pair[1];
                } else if (typeof query_string[pair[0]] === "string") {
                    var arr = [query_string[pair[0]], pair[1]];
                    query_string[pair[0]] = arr;
                } else {
                    query_string[pair[0]].push(pair[1]);
                }
            }

            return query_string;
        }

        function init() {
            Handlebars.registerHelper('handlise', function(string) {
                if (string) {
                    return string.toLowerCase().replace(/ /g, '-').replace(/\//g, '');
                }
            });

            var source = document.getElementsByClassName('template')[0].innerHTML;
            var template = Handlebars.compile(source);
            var html = template(getPageParameters(document.location.href));

            document.getElementsByClassName('target')[0].outerHTML = html;
        }

        init();
    </script>
</body>
