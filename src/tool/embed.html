<!DOCTYPE html>
<html>
<head>
    <base href="." target="_blank">
    <title>{{ name }} Embed Tool</title>
</head>

<body>
    <style>
        @font-face {
            font-family: 'Guardian Egyptian Web';
            src: url('https://interactive.guim.co.uk/fonts/guss-webfonts/GHGuardianHeadline/GHGuardianHeadline-Bold.woff2') format('woff2'),
                 url('https://interactive.guim.co.uk/fonts/guss-webfonts/GHGuardianHeadline/GHGuardianHeadline-Bold.woff') format('woff'),
                 url('https://interactive.guim.co.uk/fonts/guss-webfonts/GHGuardianHeadline/GHGuardianHeadline-Bold.ttf') format('truetype');
            font-weight: bold;
            font-style: normal;
            font-stretch: normal;
        }

        @font-face {
            font-family: 'Guardian Text Egyptian Web';
            src: url('https://interactive.guim.co.uk/fonts/latin1/Guardian Text Egyp Web-Reg.eot');
            src: url('https://interactive.guim.co.uk/fonts/latin1/Guardian Text Egyp Web-Reg.eot?#iefix') format('embedded-opentype'),
                 url('https://interactive.guim.co.uk/fonts/latin1/Guardian Text Egyp Web-Reg.woff') format('woff'),
                 url('https://interactive.guim.co.uk/fonts/latin1/Guardian Text Egyp Web-Reg.ttf') format('truetype'),
                 url('https://interactive.guim.co.uk/fonts/latin1/Guardian Text Egyp Web-Reg.svg#Guardian Sans Web-Regular') format('svg');
            font-weight: normal;
            font-style: normal;
            font-stretch: normal;
        }

        @font-face {
            font-family: 'Guardian Agate Sans';
            src: url('https://interactive.guim.co.uk/fonts/latin1/Guardian Ag Sans 1 Web-Reg.eot');
            src: url('https://interactive.guim.co.uk/fonts/latin1/Guardian Ag Sans 1 Web-Reg.eot?#iefix') format('embedded-opentype'),
                 url('https://interactive.guim.co.uk/fonts/latin1/Guardian Ag Sans 1 Web-Reg.woff') format('woff'),
                 url('https://interactive.guim.co.uk/fonts/latin1/Guardian Ag Sans 1 Web-Reg.ttf') format('truetype'),
                 url('https://interactive.guim.co.uk/fonts/latin1/Guardian Ag Sans 1 Web-Reg.svg#Guardian Sans Web-Regular') format('svg');
            font-weight: normal;
            font-style: normal;
            font-stretch: normal;
        }

        @font-face {
            font-family: 'Guardian Agate Sans';
            src: url('https://interactive.guim.co.uk/fonts/latin1/Guardian Ag Sans 1 Web-Bold.eot');
            src: url('https://interactive.guim.co.uk/fonts/latin1/Guardian Ag Sans 1 Web-Bold.eot?#iefix') format('embedded-opentype'),
                 url('https://interactive.guim.co.uk/fonts/latin1/Guardian Ag Sans 1 Web-Bold.woff') format('woff'),
                 url('https://interactive.guim.co.uk/fonts/latin1/Guardian Ag Sans 1 Web-Bold.ttf') format('truetype'),
                 url('https://interactive.guim.co.uk/fonts/latin1/Guardian Ag Sans 1 Web-Bold.svg#Guardian Sans Web-Regular') format('svg');
            font-weight: bold;
            font-style: normal;
            font-stretch: normal;
        }

        html,
        body {
            height: 100%;
            margin: 0;
        }

        body {
            color: #121212;
            font-family: 'Guardian Egyptian Web';
            font-weight: 900;
            display: flex;
            flex-direction: column;
            -webkit-font-smoothing: antialiased;
        }

        header {
            position: fixed;
            z-index: 10;
            top: 0;
            left: 0;
            right: 0;
            background-color: white;
            border-bottom: 1px solid #dfdfdf;
        }

        .header__link {
            position: relative;
            z-index: 2;
            font-size: 24px;
            line-height: 1.2;
            padding: 12px 20px;
            color: #121212;
            margin: 0;
            display: inline-block;
            background-color: #ffe500;
            border-right: 1px solid #dfdfdf;
            text-decoration: none;
        }

        .header__link:hover {
            background-color: #ffbb50;
        }

        .header__title {
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            margin: auto;
            text-align: center;
            font-size: 24px;
            line-height: 1.2;
            padding: 12px 0;
        }

        main {
            flex-grow: 2;
            display: flex;
        }

        .options,
        .preview {
            width: 50%;
            box-sizing: border-box;
            padding: 60px 20px;
        }

        .options {
            overflow-y: scroll;
            background-color: #f6f6f6;
        }

        .options-group {
            display: none;
        }

        .options-group--current {
            display: block;
        }

        .option {
            position: relative;
            padding: 12px 0;
        }

        .options__label {
            font-size: 13px;
            line-height: 1.1;
            font-family: 'Guardian Agate Sans';
            font-weight: bold;
            color: #121212;
            margin: 0px 12px 8px 0;
        }

        .options__tip {
            width: 50%;
            position: absolute;
            top: 0;
            right: 0;
            text-align: right;
            font-family: 'Guardian Agate Sans';
            font-size: 13px;
            font-weight: normal;
            line-height: 1.1;
            color: #676767;
        }

        .options__input {
            box-sizing: border-box;
            width: 100%;
            background-color: #fff;
            border-radius: 0;
            border: 1px solid #dfdfdf;
        }

        .options__input--textarea {
            height: 200px;
        }

        .options__input--checkbox {
            margin: 0;
        }

        .hidden {
            display: none;
        }

        .preview {
            position: fixed;
            left: 50%;
            right: 0;
            top: 0;
            bottom: 0;
            border-left: 1px solid #dfdfdf;
        }

        .preview__wrapper {
            background-color: #fff;
            padding: 20px;
            border: 1px solid #dfdfdf;
            margin-bottom: 12px;
        }

        .preview__iframe {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            margin: auto;
            border: 0;
            height: 500px;
            width: 380px;
            background-color: #fff;
            display: block;
        }

        input,
        textarea {
            padding: 8px;
            font-size: 16px;
            line-height: 1.4;
            font-family: 'Guardian Text Egyptian Web';
            resize: none;
            border: 1px solid #dfdfdf;
        }

        select {
            padding: 8px;
            font-size: 16px;
            font-family: 'Guardian Text Egyptian Web';
            height: 36px;
        }

        .export {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #dcdcdc;
            padding: 8px 20px;
        }

        .export__inner {
            display: flex;
            justify-content: center;
        }

        .export__button {
            position: relative;
            overflow: hidden;
            background-color: #ffe500;
            color: #121212;
            padding: 12px;
            display: inline-block;
            font-size: 13px;
            line-height: 1.1;
            font-family: 'Guardian Agate Sans';
            font-weight: bold;
            cursor: pointer;
        }

        .export__button-copied {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            padding: 12px;
            box-sizing: border-box;
            text-align: center;
            background-color: #212121;
            color: #ffe500;
            transition: transform 0.1s linear;
            transform: translateY(100%);
        }

        .export__button.is-copied .export__button-copied {
            transform: translateY(0);
        }

        .export__button:hover {
            background-color: #ffbb50;
        }

        .export__url {
            width: 50%;
            margin-right: 10px;
            display: block;
            border: 1px solid #ccc;
        }

    </style>

    <header>
        <a target='_self' class='header__link' href='{{ path }}/tools/embed-tool/'>Embed Tool</a>
        <h1 class='header__title'>Make your {{ name }} embed</h1>
    </header>

    <main>
        <div class='options'>
            {{#each fields}}
                <div class='option'>
                    <h2 class='options__label'>{{ name }}</h2>

                    {{#if tip}}
                        <h3 class='options__tip'>{{ tip }}</h3>
                    {{/if}}

                    {{#switch type}}
                        {{#case 'text'}}
                            <input class='options__input' type='text' value='{{ default }}' name='{{ handlise name }}'>
                        {{/case}}

                        {{#case 'checkbox'}}
                            <input class='options__input options__input--checkbox' type='checkbox' name='{{ handlise name }}'>
                        {{/case}}

                        {{#case 'textarea'}}
                            <textarea class='options__input options__input--textarea' name='{{ handlise name }}'>{{ default }}</textarea>
                        {{/case}}

                        {{#case 'select'}}
                            <select name='{{ handlise name }}' class='options__input'>
                                {{#each options}}
                                <option value='{{ handlise this }}'>{{ this }}</option>
                                {{/each}}
                            </select>
                        {{/case}}
                    {{/switch}}
                </div>
            {{/each}}
        </div>

        <div class='preview'>
            <iframe class='preview__iframe' data-url='{{ path }}/embed/{{ handlise name }}/index.html'></iframe>
        </div>
    </main>

    <div class='export'>
        <div class='export__inner'>
            <input type='text' class='export__url'>
            <div class='export__button'>
                <div class='export__button-copied'>Copied!</div>
                Copy Embed Url
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type='text/javascript'>
        var data = {},
            defaultUrl = '{{ path }}/embed/{{ handlise name }}/index.html'

        function buildDataObject() {
            $('.options__input').each(function(i, el) {
                if ($(el).attr('type') == 'checkbox') {
                    if ($(el).is(':checked')) {
                        data[$(el).attr('name')] = true;
                    } else {
                        data[$(el).attr('name')] = false;
                    }
                } else {
                    data[$(el).attr('name')] = $(el).val();
                }
            });
        }

        function buildURL() {
            var url = defaultUrl + '?'

            $.each(data, function(key, value) {
                url += key + '=' + encodeURIComponent(value) + '&'
            });

            url = url.substring(0, url.length - 1);

            $('.export__url').val(url);
            $('.preview__iframe').attr('src', url);
        }

        function bindings() {
            $('.options__input').change(function() {
                refreshEmbed();
            });

            var timer;

            $('.options__input').on('keyup', function() {
                clearTimeout(timer);
                timer = setTimeout(refreshEmbed, 500);
            });

            $('.options__input').on('keydown', function() {
                clearTimeout(timer);
            });

            var buttonTimer;

            $('.export__button').click(function() {
                var url = document.getElementsByClassName('export__url')[0];
                    url.select();
                    document.execCommand('copy');

                clearTimeout(buttonTimer);
                $('.export__button').addClass('is-copied');
                buttonTimer = setTimeout(function() {
                    $('.export__button').removeClass('is-copied');
                }, 2000);
            });
        }

        function refreshEmbed() {
            buildDataObject();
            buildURL();
        }

        function init() {
            buildDataObject();
            buildURL();
            bindings();
        }

        init();
    </script>
</body>
